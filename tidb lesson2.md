# tidb lesson2

<a name="zm707"></a>
## 1.部署环境的机器配置
之前lesson1安装好tiup<br />tiup cluster deploy tidb-benchmark nightly ./complex-mini.yaml  --user root -p 部署最小拓扑<br />![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598164306999-01cc2bf8-57ab-4c5b-9bf0-cfb1da711645.png#align=left&display=inline&height=454&margin=%5Bobject%20Object%5D&name=image.png&originHeight=454&originWidth=1219&size=76089&status=done&style=none&width=1219)<br />
<br />共3台机器4c16g，磁盘196g<br />![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598164131757-97dcbd6b-226d-4845-b6f9-c4b72edb8edf.png#align=left&display=inline&height=119&margin=%5Bobject%20Object%5D&name=image.png&originHeight=218&originWidth=1365&size=18733&status=done&style=none&width=746)<br />
<br />拓扑结构<br />3pd 3tikv 1tidb<br />![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598164112029-ee3d6050-1d83-409e-87a1-ab53322236c0.png#align=left&display=inline&height=523&margin=%5Bobject%20Object%5D&name=image.png&originHeight=523&originWidth=1305&size=57817&status=done&style=none&width=1305)<br />
<br />tidb默认配置<br />[binlog]<br />enable = false<br />ignore-error = false<br />[log]<br />slow-threshold = 1000<br />tikv默认配置 <br />[readpool]<br />[readpool.coprocessor]<br />use-unified-pool = true<br />[readpool.storage]<br />use-unified-pool = false
<a name="P6m9c"></a>
## 2.sysbench测试
**Point select**<br />[root@node2 sysbench]# sysbench --config-file=config oltp_point_select --threads=8 --tables=32 --table-size=200000 run<br />sysbench 1.0.20 (using bundled LuaJIT 2.1.0-beta2)<br />Running the test with following options:<br />Number of threads: 8<br />Report intermediate results every 10 second(s)<br />Initializing random number generator from current time<br />Initializing worker threads...<br />Threads started!<br />[ 10s ] thds: 8 tps: 5777.03 qps: 5777.03 (r/w/o: 5777.03/0.00/0.00) lat (ms,95%): 3.02 err/s: 0.00 reconn/s: 0.00<br />[ 20s ] thds: 8 tps: 5453.54 qps: 5453.54 (r/w/o: 5453.54/0.00/0.00) lat (ms,95%): 3.25 err/s: 0.00 reconn/s: 0.00<br />[ 30s ] thds: 8 tps: 5633.33 qps: 5633.33 (r/w/o: 5633.33/0.00/0.00) lat (ms,95%): 3.19 err/s: 0.00 reconn/s: 0.00<br />[ 40s ] thds: 8 tps: 5876.16 qps: 5876.16 (r/w/o: 5876.16/0.00/0.00) lat (ms,95%): 2.91 err/s: 0.00 reconn/s: 0.00<br />[ 50s ] thds: 8 tps: 5627.19 qps: 5627.19 (r/w/o: 5627.19/0.00/0.00) lat (ms,95%): 3.13 err/s: 0.00 reconn/s: 0.00<br />[ 60s ] thds: 8 tps: 5728.26 qps: 5728.26 (r/w/o: 5728.26/0.00/0.00) lat (ms,95%): 3.07 err/s: 0.00 reconn/s: 0.00<br />[ 70s ] thds: 8 tps: 5780.85 qps: 5780.85 (r/w/o: 5780.85/0.00/0.00) lat (ms,95%): 3.02 err/s: 0.00 reconn/s: 0.00<br />[ 80s ] thds: 8 tps: 5800.24 qps: 5800.24 (r/w/o: 5800.24/0.00/0.00) lat (ms,95%): 3.02 err/s: 0.00 reconn/s: 0.00<br />[ 90s ] thds: 8 tps: 5750.41 qps: 5750.41 (r/w/o: 5750.41/0.00/0.00) lat (ms,95%): 3.07 err/s: 0.00 reconn/s: 0.00<br />[ 100s ] thds: 8 tps: 5669.11 qps: 5669.11 (r/w/o: 5669.11/0.00/0.00) lat (ms,95%): 3.13 err/s: 0.00 reconn/s: 0.00<br />[ 110s ] thds: 8 tps: 5571.39 qps: 5571.39 (r/w/o: 5571.39/0.00/0.00) lat (ms,95%): 3.25 err/s: 0.00 reconn/s: 0.00<br />[ 120s ] thds: 8 tps: 5430.19 qps: 5430.19 (r/w/o: 5430.19/0.00/0.00) lat (ms,95%): 3.36 err/s: 0.00 reconn/s: 0.00<br />[ 130s ] thds: 8 tps: 5590.59 qps: 5590.59 (r/w/o: 5590.59/0.00/0.00) lat (ms,95%): 3.25 err/s: 0.00 reconn/s: 0.00<br />[ 140s ] thds: 8 tps: 5766.50 qps: 5766.50 (r/w/o: 5766.50/0.00/0.00) lat (ms,95%): 3.07 err/s: 0.00 reconn/s: 0.00<br />[ 150s ] thds: 8 tps: 5947.84 qps: 5947.84 (r/w/o: 5947.84/0.00/0.00) lat (ms,95%): 2.91 err/s: 0.00 reconn/s: 0.00<br />[ 160s ] thds: 8 tps: 5726.04 qps: 5726.04 (r/w/o: 5726.04/0.00/0.00) lat (ms,95%): 3.02 err/s: 0.00 reconn/s: 0.00<br />[ 170s ] thds: 8 tps: 5699.53 qps: 5699.53 (r/w/o: 5699.53/0.00/0.00) lat (ms,95%): 3.13 err/s: 0.00 reconn/s: 0.00<br />[ 180s ] thds: 8 tps: 6076.78 qps: 6076.78 (r/w/o: 6076.78/0.00/0.00) lat (ms,95%): 2.86 err/s: 0.00 reconn/s: 0.00<br />[ 190s ] thds: 8 tps: 5787.11 qps: 5787.11 (r/w/o: 5787.11/0.00/0.00) lat (ms,95%): 2.97 err/s: 0.00 reconn/s: 0.00<br />[ 200s ] thds: 8 tps: 5985.51 qps: 5985.51 (r/w/o: 5985.51/0.00/0.00) lat (ms,95%): 2.81 err/s: 0.00 reconn/s: 0.00<br />[ 210s ] thds: 8 tps: 5769.33 qps: 5769.33 (r/w/o: 5769.33/0.00/0.00) lat (ms,95%): 3.02 err/s: 0.00 reconn/s: 0.00<br />[ 220s ] thds: 8 tps: 5535.01 qps: 5535.01 (r/w/o: 5535.01/0.00/0.00) lat (ms,95%): 3.19 err/s: 0.00 reconn/s: 0.00<br />[ 230s ] thds: 8 tps: 5268.44 qps: 5268.44 (r/w/o: 5268.44/0.00/0.00) lat (ms,95%): 3.30 err/s: 0.00 reconn/s: 0.00<br />[ 240s ] thds: 8 tps: 5622.54 qps: 5622.54 (r/w/o: 5622.54/0.00/0.00) lat (ms,95%): 3.25 err/s: 0.00 reconn/s: 0.00<br />[ 250s ] thds: 8 tps: 5591.37 qps: 5591.37 (r/w/o: 5591.37/0.00/0.00) lat (ms,95%): 3.43 err/s: 0.00 reconn/s: 0.00<br />[ 260s ] thds: 8 tps: 5675.17 qps: 5675.17 (r/w/o: 5675.17/0.00/0.00) lat (ms,95%): 3.19 err/s: 0.00 reconn/s: 0.00<br />[ 270s ] thds: 8 tps: 5598.99 qps: 5598.99 (r/w/o: 5598.99/0.00/0.00) lat (ms,95%): 3.19 err/s: 0.00 reconn/s: 0.00<br />[ 280s ] thds: 8 tps: 5674.11 qps: 5674.11 (r/w/o: 5674.11/0.00/0.00) lat (ms,95%): 3.13 err/s: 0.00 reconn/s: 0.00<br />[ 290s ] thds: 8 tps: 5795.75 qps: 5795.75 (r/w/o: 5795.75/0.00/0.00) lat (ms,95%): 2.97 err/s: 0.00 reconn/s: 0.00<br />[ 300s ] thds: 8 tps: 6027.15 qps: 6027.15 (r/w/o: 6027.15/0.00/0.00) lat (ms,95%): 2.71 err/s: 0.00 reconn/s: 0.00<br />[ 310s ] thds: 8 tps: 6248.45 qps: 6248.45 (r/w/o: 6248.45/0.00/0.00) lat (ms,95%): 2.57 err/s: 0.00 reconn/s: 0.00<br />[ 320s ] thds: 8 tps: 5553.45 qps: 5553.45 (r/w/o: 5553.45/0.00/0.00) lat (ms,95%): 3.13 err/s: 0.00 reconn/s: 0.00<br />[ 330s ] thds: 8 tps: 5581.19 qps: 5581.19 (r/w/o: 5581.19/0.00/0.00) lat (ms,95%): 3.19 err/s: 0.00 reconn/s: 0.00<br />[ 340s ] thds: 8 tps: 5442.46 qps: 5442.46 (r/w/o: 5442.46/0.00/0.00) lat (ms,95%): 3.30 err/s: 0.00 reconn/s: 0.00<br />[ 350s ] thds: 8 tps: 5081.05 qps: 5081.05 (r/w/o: 5081.05/0.00/0.00) lat (ms,95%): 3.43 err/s: 0.00 reconn/s: 0.00<br />[ 360s ] thds: 8 tps: 5298.22 qps: 5298.22 (r/w/o: 5298.22/0.00/0.00) lat (ms,95%): 3.19 err/s: 0.00 reconn/s: 0.00<br />[ 370s ] thds: 8 tps: 5117.21 qps: 5117.21 (r/w/o: 5117.21/0.00/0.00) lat (ms,95%): 3.02 err/s: 0.00 reconn/s: 0.00<br />[ 380s ] thds: 8 tps: 5754.82 qps: 5754.82 (r/w/o: 5754.82/0.00/0.00) lat (ms,95%): 2.91 err/s: 0.00 reconn/s: 0.00<br />[ 390s ] thds: 8 tps: 5881.75 qps: 5881.75 (r/w/o: 5881.75/0.00/0.00) lat (ms,95%): 2.86 err/s: 0.00 reconn/s: 0.00<br />[ 400s ] thds: 8 tps: 5771.28 qps: 5771.28 (r/w/o: 5771.28/0.00/0.00) lat (ms,95%): 2.91 err/s: 0.00 reconn/s: 0.00<br />[ 410s ] thds: 8 tps: 5588.75 qps: 5588.75 (r/w/o: 5588.75/0.00/0.00) lat (ms,95%): 3.02 err/s: 0.00 reconn/s: 0.00<br />[ 420s ] thds: 8 tps: 6026.82 qps: 6026.82 (r/w/o: 6026.82/0.00/0.00) lat (ms,95%): 2.81 err/s: 0.00 reconn/s: 0.00<br />[ 430s ] thds: 8 tps: 5894.41 qps: 5894.41 (r/w/o: 5894.41/0.00/0.00) lat (ms,95%): 2.81 err/s: 0.00 reconn/s: 0.00<br />[ 440s ] thds: 8 tps: 5536.24 qps: 5536.24 (r/w/o: 5536.24/0.00/0.00) lat (ms,95%): 3.19 err/s: 0.00 reconn/s: 0.00<br />[ 450s ] thds: 8 tps: 5118.52 qps: 5118.52 (r/w/o: 5118.52/0.00/0.00) lat (ms,95%): 3.55 err/s: 0.00 reconn/s: 0.00<br />[ 460s ] thds: 8 tps: 4194.59 qps: 4194.59 (r/w/o: 4194.59/0.00/0.00) lat (ms,95%): 3.96 err/s: 0.00 reconn/s: 0.00<br />[ 470s ] thds: 8 tps: 4508.28 qps: 4508.28 (r/w/o: 4508.28/0.00/0.00) lat (ms,95%): 4.10 err/s: 0.00 reconn/s: 0.00<br />[ 480s ] thds: 8 tps: 4812.15 qps: 4812.15 (r/w/o: 4812.15/0.00/0.00) lat (ms,95%): 3.75 err/s: 0.00 reconn/s: 0.00<br />[ 490s ] thds: 8 tps: 4935.05 qps: 4935.05 (r/w/o: 4935.05/0.00/0.00) lat (ms,95%): 3.89 err/s: 0.00 reconn/s: 0.00<br />[ 500s ] thds: 8 tps: 4602.14 qps: 4602.14 (r/w/o: 4602.14/0.00/0.00) lat (ms,95%): 4.18 err/s: 0.00 reconn/s: 0.00<br />[ 510s ] thds: 8 tps: 5595.27 qps: 5595.27 (r/w/o: 5595.27/0.00/0.00) lat (ms,95%): 3.25 err/s: 0.00 reconn/s: 0.00<br />[ 520s ] thds: 8 tps: 5922.51 qps: 5922.51 (r/w/o: 5922.51/0.00/0.00) lat (ms,95%): 2.86 err/s: 0.00 reconn/s: 0.00<br />[ 530s ] thds: 8 tps: 5924.68 qps: 5924.68 (r/w/o: 5924.68/0.00/0.00) lat (ms,95%): 2.81 err/s: 0.00 reconn/s: 0.00<br />[ 540s ] thds: 8 tps: 6000.93 qps: 6000.93 (r/w/o: 6000.93/0.00/0.00) lat (ms,95%): 2.81 err/s: 0.00 reconn/s: 0.00<br />[ 550s ] thds: 8 tps: 5630.98 qps: 5630.98 (r/w/o: 5630.98/0.00/0.00) lat (ms,95%): 2.86 err/s: 0.00 reconn/s: 0.00<br />[ 560s ] thds: 8 tps: 5232.19 qps: 5232.19 (r/w/o: 5232.19/0.00/0.00) lat (ms,95%): 3.13 err/s: 0.00 reconn/s: 0.00<br />[ 570s ] thds: 8 tps: 5444.18 qps: 5444.18 (r/w/o: 5444.18/0.00/0.00) lat (ms,95%): 3.36 err/s: 0.00 reconn/s: 0.00<br />[ 580s ] thds: 8 tps: 4675.31 qps: 4675.31 (r/w/o: 4675.31/0.00/0.00) lat (ms,95%): 3.75 err/s: 0.00 reconn/s: 0.00<br />[ 590s ] thds: 8 tps: 2763.63 qps: 2763.63 (r/w/o: 2763.63/0.00/0.00) lat (ms,95%): 4.65 err/s: 0.00 reconn/s: 0.00<br />[ 600s ] thds: 8 tps: 5091.32 qps: 5091.32 (r/w/o: 5091.32/0.00/0.00) lat (ms,95%): 3.75 err/s: 0.00 reconn/s: 0.00<br />SQL statistics:<br />    queries performed:<br />        read:                            3304647<br />        write:                           0<br />        other:                           0<br />        total:                           3304647<br />    transactions:                        3304647 (5505.30 per sec.)<br />    queries:                             3304647 (5505.30 per sec.)<br />    ignored errors:                      0      (0.00 per sec.)<br />    reconnects:                          0      (0.00 per sec.)<br />General statistics:<br />    total time:                          600.2628s<br />    total number of events:              3304647<br />Latency (ms):<br />         min:                                    0.22<br />         avg:                                    1.45<br />         max:                                 1631.47<br />         95th percentile:                        3.13<br />         sum:                              4796290.36<br />Threads fairness:<br />    events (avg/stddev):           413080.8750/7308.84<br />    execution time (avg/stddev):   599.5363/0.08<br />**TiDB Query Summary 中的 qps 与 duration截图**<br />**![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598171178647-6eaa15ba-af94-4bca-ba36-58a0c81e6549.png#align=left&display=inline&height=521&margin=%5Bobject%20Object%5D&name=image.png&originHeight=521&originWidth=924&size=63095&status=done&style=none&width=924)**<br />**TiKV Details 面板中 Cluster 中各 server 的 CPU 以及 QPS 指标截图**<br />**![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598171232191-704c2a32-4ffb-40fb-aa03-75e18605a7d4.png#align=left&display=inline&height=324&margin=%5Bobject%20Object%5D&name=image.png&originHeight=324&originWidth=920&size=56639&status=done&style=none&width=920)**<br />**![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598171259594-8191012c-b3c3-4480-ad12-8d80bb47736f.png#align=left&display=inline&height=329&margin=%5Bobject%20Object%5D&name=image.png&originHeight=329&originWidth=909&size=70567&status=done&style=none&width=909)**<br />**TiKV Details 面板中 grpc 的 qps 以及 duration截图**<br />**![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598171338397-7fe75f2b-13f7-4e0b-86dc-a1cf3292688a.png#align=left&display=inline&height=330&margin=%5Bobject%20Object%5D&name=image.png&originHeight=330&originWidth=925&size=46342&status=done&style=none&width=925)**<br />**![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598171355965-528ac472-7908-4f56-a912-e44cd5da8b53.png#align=left&display=inline&height=327&margin=%5Bobject%20Object%5D&name=image.png&originHeight=327&originWidth=917&size=70914&status=done&style=none&width=917)**<br />**![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598171376004-7a7b5502-3eaa-487c-85a2-3948e864e6c7.png#align=left&display=inline&height=329&margin=%5Bobject%20Object%5D&name=image.png&originHeight=329&originWidth=920&size=75783&status=done&style=none&width=920)**<br />**Update index**<br />[root@node2 sysbench]# sysbench --config-file=config  oltp_update_index --threads=8 --tables=32 --table-size=200000 run<br />sysbench 1.0.20 (using bundled LuaJIT 2.1.0-beta2)<br />Running the test with following options:<br />Number of threads: 8<br />Report intermediate results every 10 second(s)<br />Initializing random number generator from current time<br />Initializing worker threads...<br />Threads started!<br />[ 10s ] thds: 8 tps: 677.61 qps: 677.61 (r/w/o: 0.00/677.61/0.00) lat (ms,95%): 23.10 err/s: 0.00 reconn/s: 0.00<br />[ 20s ] thds: 8 tps: 674.97 qps: 674.97 (r/w/o: 0.00/674.97/0.00) lat (ms,95%): 22.69 err/s: 0.00 reconn/s: 0.00<br />[ 30s ] thds: 8 tps: 680.59 qps: 680.59 (r/w/o: 0.00/680.59/0.00) lat (ms,95%): 22.28 err/s: 0.00 reconn/s: 0.00<br />[ 40s ] thds: 8 tps: 652.70 qps: 652.70 (r/w/o: 0.00/652.70/0.00) lat (ms,95%): 24.83 err/s: 0.00 reconn/s: 0.00<br />[ 50s ] thds: 8 tps: 711.96 qps: 711.96 (r/w/o: 0.00/711.96/0.00) lat (ms,95%): 20.37 err/s: 0.00 reconn/s: 0.00<br />[ 60s ] thds: 8 tps: 697.85 qps: 697.85 (r/w/o: 0.00/697.85/0.00) lat (ms,95%): 21.11 err/s: 0.00 reconn/s: 0.00<br />[ 70s ] thds: 8 tps: 667.18 qps: 667.18 (r/w/o: 0.00/667.18/0.00) lat (ms,95%): 22.69 err/s: 0.00 reconn/s: 0.00<br />[ 80s ] thds: 8 tps: 685.38 qps: 685.38 (r/w/o: 0.00/685.38/0.00) lat (ms,95%): 21.50 err/s: 0.00 reconn/s: 0.00<br />[ 90s ] thds: 8 tps: 687.11 qps: 687.11 (r/w/o: 0.00/687.11/0.00) lat (ms,95%): 21.89 err/s: 0.00 reconn/s: 0.00<br />[ 100s ] thds: 8 tps: 672.41 qps: 672.41 (r/w/o: 0.00/672.41/0.00) lat (ms,95%): 22.69 err/s: 0.00 reconn/s: 0.00<br />[ 110s ] thds: 8 tps: 716.10 qps: 716.10 (r/w/o: 0.00/716.10/0.00) lat (ms,95%): 20.74 err/s: 0.00 reconn/s: 0.00<br />[ 120s ] thds: 8 tps: 755.09 qps: 755.09 (r/w/o: 0.00/755.09/0.00) lat (ms,95%): 19.65 err/s: 0.00 reconn/s: 0.00<br />[ 130s ] thds: 8 tps: 681.20 qps: 681.20 (r/w/o: 0.00/681.20/0.00) lat (ms,95%): 21.89 err/s: 0.00 reconn/s: 0.00<br />[ 140s ] thds: 8 tps: 681.72 qps: 681.72 (r/w/o: 0.00/681.72/0.00) lat (ms,95%): 22.28 err/s: 0.00 reconn/s: 0.00<br />[ 150s ] thds: 8 tps: 644.79 qps: 644.79 (r/w/o: 0.00/644.79/0.00) lat (ms,95%): 23.95 err/s: 0.00 reconn/s: 0.00<br />[ 160s ] thds: 8 tps: 683.39 qps: 683.39 (r/w/o: 0.00/683.39/0.00) lat (ms,95%): 21.50 err/s: 0.00 reconn/s: 0.00<br />[ 170s ] thds: 8 tps: 637.80 qps: 637.80 (r/w/o: 0.00/637.80/0.00) lat (ms,95%): 23.95 err/s: 0.00 reconn/s: 0.00<br />[ 180s ] thds: 8 tps: 709.20 qps: 709.20 (r/w/o: 0.00/709.20/0.00) lat (ms,95%): 20.74 err/s: 0.00 reconn/s: 0.00<br />[ 190s ] thds: 8 tps: 688.80 qps: 688.80 (r/w/o: 0.00/688.80/0.00) lat (ms,95%): 21.11 err/s: 0.00 reconn/s: 0.00<br />[ 200s ] thds: 8 tps: 644.60 qps: 644.60 (r/w/o: 0.00/644.60/0.00) lat (ms,95%): 23.52 err/s: 0.00 reconn/s: 0.00<br />[ 210s ] thds: 8 tps: 675.06 qps: 675.06 (r/w/o: 0.00/675.06/0.00) lat (ms,95%): 21.89 err/s: 0.00 reconn/s: 0.00<br />[ 220s ] thds: 8 tps: 685.27 qps: 685.27 (r/w/o: 0.00/685.27/0.00) lat (ms,95%): 21.50 err/s: 0.00 reconn/s: 0.00<br />[ 230s ] thds: 8 tps: 672.46 qps: 672.46 (r/w/o: 0.00/672.46/0.00) lat (ms,95%): 22.28 err/s: 0.00 reconn/s: 0.00<br />[ 240s ] thds: 8 tps: 691.64 qps: 691.64 (r/w/o: 0.00/691.64/0.00) lat (ms,95%): 20.74 err/s: 0.00 reconn/s: 0.00<br />[ 250s ] thds: 8 tps: 666.51 qps: 666.51 (r/w/o: 0.00/666.51/0.00) lat (ms,95%): 22.28 err/s: 0.00 reconn/s: 0.00<br />[ 260s ] thds: 8 tps: 645.77 qps: 645.77 (r/w/o: 0.00/645.77/0.00) lat (ms,95%): 23.10 err/s: 0.00 reconn/s: 0.00<br />[ 270s ] thds: 8 tps: 661.92 qps: 661.92 (r/w/o: 0.00/661.92/0.00) lat (ms,95%): 22.69 err/s: 0.00 reconn/s: 0.00<br />[ 280s ] thds: 8 tps: 659.69 qps: 659.69 (r/w/o: 0.00/659.69/0.00) lat (ms,95%): 22.69 err/s: 0.00 reconn/s: 0.00<br />[ 290s ] thds: 8 tps: 636.43 qps: 636.43 (r/w/o: 0.00/636.43/0.00) lat (ms,95%): 23.95 err/s: 0.00 reconn/s: 0.00<br />[ 300s ] thds: 8 tps: 675.48 qps: 675.48 (r/w/o: 0.00/675.48/0.00) lat (ms,95%): 21.50 err/s: 0.00 reconn/s: 0.00<br />[ 310s ] thds: 8 tps: 689.00 qps: 689.00 (r/w/o: 0.00/689.00/0.00) lat (ms,95%): 21.11 err/s: 0.00 reconn/s: 0.00<br />[ 320s ] thds: 8 tps: 704.74 qps: 704.74 (r/w/o: 0.00/704.74/0.00) lat (ms,95%): 22.28 err/s: 0.00 reconn/s: 0.00<br />[ 330s ] thds: 8 tps: 673.99 qps: 673.99 (r/w/o: 0.00/673.99/0.00) lat (ms,95%): 22.28 err/s: 0.00 reconn/s: 0.00<br />[ 340s ] thds: 8 tps: 681.92 qps: 681.92 (r/w/o: 0.00/681.92/0.00) lat (ms,95%): 22.28 err/s: 0.00 reconn/s: 0.00<br />[ 350s ] thds: 8 tps: 628.91 qps: 628.91 (r/w/o: 0.00/628.91/0.00) lat (ms,95%): 24.38 err/s: 0.00 reconn/s: 0.00<br />[ 360s ] thds: 8 tps: 642.60 qps: 642.60 (r/w/o: 0.00/642.60/0.00) lat (ms,95%): 23.95 err/s: 0.00 reconn/s: 0.00<br />[ 370s ] thds: 8 tps: 681.22 qps: 681.22 (r/w/o: 0.00/681.22/0.00) lat (ms,95%): 21.50 err/s: 0.00 reconn/s: 0.00<br />[ 380s ] thds: 8 tps: 667.76 qps: 667.76 (r/w/o: 0.00/667.76/0.00) lat (ms,95%): 22.69 err/s: 0.00 reconn/s: 0.00<br />[ 390s ] thds: 8 tps: 637.02 qps: 637.02 (r/w/o: 0.00/637.02/0.00) lat (ms,95%): 23.10 err/s: 0.00 reconn/s: 0.00<br />[ 400s ] thds: 8 tps: 686.01 qps: 686.01 (r/w/o: 0.00/686.01/0.00) lat (ms,95%): 21.89 err/s: 0.00 reconn/s: 0.00<br />[ 410s ] thds: 8 tps: 696.13 qps: 696.13 (r/w/o: 0.00/696.13/0.00) lat (ms,95%): 21.11 err/s: 0.00 reconn/s: 0.00<br />[ 420s ] thds: 8 tps: 671.38 qps: 671.38 (r/w/o: 0.00/671.38/0.00) lat (ms,95%): 22.28 err/s: 0.00 reconn/s: 0.00<br />[ 430s ] thds: 8 tps: 660.70 qps: 660.70 (r/w/o: 0.00/660.70/0.00) lat (ms,95%): 22.69 err/s: 0.00 reconn/s: 0.00<br />[ 440s ] thds: 8 tps: 662.37 qps: 662.37 (r/w/o: 0.00/662.37/0.00) lat (ms,95%): 22.69 err/s: 0.00 reconn/s: 0.00<br />[ 450s ] thds: 8 tps: 622.89 qps: 622.89 (r/w/o: 0.00/622.89/0.00) lat (ms,95%): 24.38 err/s: 0.00 reconn/s: 0.00<br />[ 460s ] thds: 8 tps: 694.73 qps: 694.73 (r/w/o: 0.00/694.73/0.00) lat (ms,95%): 21.50 err/s: 0.00 reconn/s: 0.00<br />[ 470s ] thds: 8 tps: 633.10 qps: 633.10 (r/w/o: 0.00/633.10/0.00) lat (ms,95%): 25.28 err/s: 0.00 reconn/s: 0.00<br />[ 480s ] thds: 8 tps: 709.61 qps: 709.61 (r/w/o: 0.00/709.61/0.00) lat (ms,95%): 20.74 err/s: 0.00 reconn/s: 0.00<br />[ 490s ] thds: 8 tps: 681.69 qps: 681.69 (r/w/o: 0.00/681.69/0.00) lat (ms,95%): 22.69 err/s: 0.00 reconn/s: 0.00<br />[ 500s ] thds: 8 tps: 678.60 qps: 678.60 (r/w/o: 0.00/678.60/0.00) lat (ms,95%): 21.50 err/s: 0.00 reconn/s: 0.00<br />[ 510s ] thds: 8 tps: 668.32 qps: 668.32 (r/w/o: 0.00/668.32/0.00) lat (ms,95%): 22.69 err/s: 0.00 reconn/s: 0.00<br />[ 520s ] thds: 8 tps: 665.48 qps: 665.48 (r/w/o: 0.00/665.48/0.00) lat (ms,95%): 22.69 err/s: 0.00 reconn/s: 0.00<br />[ 530s ] thds: 8 tps: 669.16 qps: 669.16 (r/w/o: 0.00/669.16/0.00) lat (ms,95%): 23.10 err/s: 0.00 reconn/s: 0.00<br />[ 540s ] thds: 8 tps: 671.94 qps: 671.94 (r/w/o: 0.00/671.94/0.00) lat (ms,95%): 21.89 err/s: 0.00 reconn/s: 0.00<br />[ 550s ] thds: 8 tps: 665.60 qps: 665.60 (r/w/o: 0.00/665.60/0.00) lat (ms,95%): 23.52 err/s: 0.00 reconn/s: 0.00<br />[ 560s ] thds: 8 tps: 669.62 qps: 669.62 (r/w/o: 0.00/669.62/0.00) lat (ms,95%): 22.69 err/s: 0.00 reconn/s: 0.00<br />[ 570s ] thds: 8 tps: 677.59 qps: 677.59 (r/w/o: 0.00/677.59/0.00) lat (ms,95%): 22.28 err/s: 0.00 reconn/s: 0.00<br />[ 580s ] thds: 8 tps: 623.38 qps: 623.38 (r/w/o: 0.00/623.38/0.00) lat (ms,95%): 25.28 err/s: 0.00 reconn/s: 0.00<br />[ 590s ] thds: 8 tps: 636.83 qps: 636.83 (r/w/o: 0.00/636.83/0.00) lat (ms,95%): 25.28 err/s: 0.00 reconn/s: 0.00<br />[ 600s ] thds: 8 tps: 663.37 qps: 663.37 (r/w/o: 0.00/663.37/0.00) lat (ms,95%): 22.69 err/s: 0.00 reconn/s: 0.00<br />SQL statistics:<br />    queries performed:<br />        read:                            0<br />        write:                           403373<br />        other:                           0<br />        total:                           403373<br />    transactions:                        403373 (672.27 per sec.)<br />    queries:                             403373 (672.27 per sec.)<br />    ignored errors:                      0      (0.00 per sec.)<br />    reconnects:                          0      (0.00 per sec.)<br />General statistics:<br />    total time:                          600.0125s<br />    total number of events:              403373<br />Latency (ms):<br />         min:                                    3.79<br />         avg:                                   11.90<br />         max:                                 1138.64<br />         95th percentile:                       22.28<br />         sum:                              4798942.77<br />Threads fairness:<br />    events (avg/stddev):           50421.6250/114.76<br />    execution time (avg/stddev):   599.8678/0.01<br />**TiDB Query Summary 中的 qps 与 duration截图**<br />![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598170084025-2b19cae7-2033-4acb-816b-ed0641d40b3e.png#align=left&display=inline&height=529&margin=%5Bobject%20Object%5D&name=image.png&originHeight=529&originWidth=923&size=61322&status=done&style=none&width=923)<br />**TiKV Details 面板中 Cluster 中各 server 的 CPU 以及 QPS 指标截图**<br />![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598170213590-deceb048-0fa4-46f8-8e50-e4728f4fedc8.png#align=left&display=inline&height=322&margin=%5Bobject%20Object%5D&name=image.png&originHeight=322&originWidth=914&size=55343&status=done&style=none&width=914)<br />**![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598170308340-724336a0-ba83-4171-a661-6ded087e11ed.png#align=left&display=inline&height=318&margin=%5Bobject%20Object%5D&name=image.png&originHeight=318&originWidth=926&size=73641&status=done&style=none&width=926)**<br />**TiKV Details 面板中 grpc 的 qps 以及 duration截图**<br />**![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598170361881-9648e26d-313e-4ee9-9a2b-63ef9677cc1f.png#align=left&display=inline&height=327&margin=%5Bobject%20Object%5D&name=image.png&originHeight=327&originWidth=924&size=69997&status=done&style=none&width=924)**<br />**![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598170397639-c96d848f-630c-4614-81bf-d68e62657315.png#align=left&display=inline&height=325&margin=%5Bobject%20Object%5D&name=image.png&originHeight=325&originWidth=924&size=79155&status=done&style=none&width=924)**<br />**![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598170439888-d2f3c2b6-c1dc-4a2d-b1fd-9e4a1b42fb08.png#align=left&display=inline&height=330&margin=%5Bobject%20Object%5D&name=image.png&originHeight=330&originWidth=917&size=46726&status=done&style=none&width=917)**<br />**Read Only**<br />[root@node2 sysbench]# sysbench --config-file=config oltp_read_only --threads=8 --tables=32 --table-size=200000 run<br />sysbench 1.0.20 (using bundled LuaJIT 2.1.0-beta2)<br />Running the test with following options:<br />Number of threads: 8<br />Report intermediate results every 10 second(s)<br />Initializing random number generator from current time<br />Initializing worker threads...<br />Threads started!<br />[ 10s ] thds: 8 tps: 216.67 qps: 3473.74 (r/w/o: 3039.59/0.00/434.14) lat (ms,95%): 59.99 err/s: 0.00 reconn/s: 0.00<br />[ 20s ] thds: 8 tps: 232.43 qps: 3719.14 (r/w/o: 3254.38/0.00/464.77) lat (ms,95%): 51.02 err/s: 0.00 reconn/s: 0.00<br />[ 30s ] thds: 8 tps: 223.65 qps: 3577.43 (r/w/o: 3130.03/0.00/447.40) lat (ms,95%): 54.83 err/s: 0.00 reconn/s: 0.00<br />[ 40s ] thds: 8 tps: 219.67 qps: 3514.85 (r/w/o: 3075.52/0.00/439.33) lat (ms,95%): 55.82 err/s: 0.00 reconn/s: 0.00<br />[ 50s ] thds: 8 tps: 234.40 qps: 3748.92 (r/w/o: 3280.13/0.00/468.79) lat (ms,95%): 51.02 err/s: 0.00 reconn/s: 0.00<br />[ 60s ] thds: 8 tps: 226.21 qps: 3620.41 (r/w/o: 3168.09/0.00/452.33) lat (ms,95%): 54.83 err/s: 0.00 reconn/s: 0.00<br />[ 70s ] thds: 8 tps: 227.73 qps: 3644.17 (r/w/o: 3188.61/0.00/455.56) lat (ms,95%): 51.94 err/s: 0.00 reconn/s: 0.00<br />[ 80s ] thds: 8 tps: 231.53 qps: 3704.00 (r/w/o: 3240.94/0.00/463.06) lat (ms,95%): 51.02 err/s: 0.00 reconn/s: 0.00<br />[ 90s ] thds: 8 tps: 236.58 qps: 3785.34 (r/w/o: 3312.27/0.00/473.07) lat (ms,95%): 52.89 err/s: 0.00 reconn/s: 0.00<br />[ 100s ] thds: 8 tps: 226.13 qps: 3618.63 (r/w/o: 3166.26/0.00/452.37) lat (ms,95%): 52.89 err/s: 0.00 reconn/s: 0.00<br />[ 110s ] thds: 8 tps: 227.06 qps: 3634.80 (r/w/o: 3180.77/0.00/454.02) lat (ms,95%): 53.85 err/s: 0.00 reconn/s: 0.00<br />[ 120s ] thds: 8 tps: 216.70 qps: 3466.34 (r/w/o: 3032.93/0.00/433.40) lat (ms,95%): 56.84 err/s: 0.00 reconn/s: 0.00<br />[ 130s ] thds: 8 tps: 219.59 qps: 3512.31 (r/w/o: 3073.02/0.00/439.29) lat (ms,95%): 55.82 err/s: 0.00 reconn/s: 0.00<br />[ 140s ] thds: 8 tps: 221.48 qps: 3542.99 (r/w/o: 3100.03/0.00/442.96) lat (ms,95%): 55.82 err/s: 0.00 reconn/s: 0.00<br />[ 150s ] thds: 8 tps: 222.18 qps: 3554.61 (r/w/o: 3110.26/0.00/444.35) lat (ms,95%): 53.85 err/s: 0.00 reconn/s: 0.00<br />[ 160s ] thds: 8 tps: 223.11 qps: 3571.89 (r/w/o: 3125.67/0.00/446.22) lat (ms,95%): 52.89 err/s: 0.00 reconn/s: 0.00<br />[ 170s ] thds: 8 tps: 222.97 qps: 3567.00 (r/w/o: 3121.05/0.00/445.95) lat (ms,95%): 56.84 err/s: 0.00 reconn/s: 0.00<br />[ 180s ] thds: 8 tps: 222.28 qps: 3555.79 (r/w/o: 3111.32/0.00/444.46) lat (ms,95%): 55.82 err/s: 0.00 reconn/s: 0.00<br />[ 190s ] thds: 8 tps: 223.67 qps: 3580.28 (r/w/o: 3132.84/0.00/447.43) lat (ms,95%): 52.89 err/s: 0.00 reconn/s: 0.00<br />[ 200s ] thds: 8 tps: 228.50 qps: 3656.92 (r/w/o: 3199.92/0.00/457.00) lat (ms,95%): 54.83 err/s: 0.00 reconn/s: 0.00<br />[ 210s ] thds: 8 tps: 226.33 qps: 3620.25 (r/w/o: 3167.58/0.00/452.67) lat (ms,95%): 54.83 err/s: 0.00 reconn/s: 0.00<br />[ 220s ] thds: 8 tps: 227.36 qps: 3635.92 (r/w/o: 3181.20/0.00/454.73) lat (ms,95%): 53.85 err/s: 0.00 reconn/s: 0.00<br />[ 230s ] thds: 8 tps: 228.79 qps: 3660.79 (r/w/o: 3203.31/0.00/457.49) lat (ms,95%): 52.89 err/s: 0.00 reconn/s: 0.00<br />[ 240s ] thds: 8 tps: 232.22 qps: 3717.05 (r/w/o: 3252.61/0.00/464.43) lat (ms,95%): 52.89 err/s: 0.00 reconn/s: 0.00<br />[ 250s ] thds: 8 tps: 228.72 qps: 3659.88 (r/w/o: 3202.45/0.00/457.44) lat (ms,95%): 51.02 err/s: 0.00 reconn/s: 0.00<br />[ 260s ] thds: 8 tps: 224.21 qps: 3585.59 (r/w/o: 3137.18/0.00/448.41) lat (ms,95%): 54.83 err/s: 0.00 reconn/s: 0.00<br />[ 270s ] thds: 8 tps: 222.23 qps: 3554.22 (r/w/o: 3109.76/0.00/444.47) lat (ms,95%): 54.83 err/s: 0.00 reconn/s: 0.00<br />[ 280s ] thds: 8 tps: 215.06 qps: 3443.51 (r/w/o: 3013.29/0.00/430.21) lat (ms,95%): 57.87 err/s: 0.00 reconn/s: 0.00<br />[ 290s ] thds: 8 tps: 202.94 qps: 3245.44 (r/w/o: 2839.56/0.00/405.88) lat (ms,95%): 65.65 err/s: 0.00 reconn/s: 0.00<br />[ 300s ] thds: 8 tps: 216.95 qps: 3472.17 (r/w/o: 3038.27/0.00/433.90) lat (ms,95%): 57.87 err/s: 0.00 reconn/s: 0.00<br />[ 310s ] thds: 8 tps: 222.57 qps: 3561.98 (r/w/o: 3116.95/0.00/445.04) lat (ms,95%): 54.83 err/s: 0.00 reconn/s: 0.00<br />[ 320s ] thds: 8 tps: 233.97 qps: 3741.59 (r/w/o: 3273.75/0.00/467.84) lat (ms,95%): 52.89 err/s: 0.00 reconn/s: 0.00<br />[ 330s ] thds: 8 tps: 242.74 qps: 3886.67 (r/w/o: 3400.99/0.00/485.68) lat (ms,95%): 49.21 err/s: 0.00 reconn/s: 0.00<br />[ 340s ] thds: 8 tps: 238.60 qps: 3814.22 (r/w/o: 3337.02/0.00/477.20) lat (ms,95%): 50.11 err/s: 0.00 reconn/s: 0.00<br />[ 350s ] thds: 8 tps: 242.71 qps: 3886.06 (r/w/o: 3400.64/0.00/485.42) lat (ms,95%): 50.11 err/s: 0.00 reconn/s: 0.00<br />[ 360s ] thds: 8 tps: 245.83 qps: 3934.22 (r/w/o: 3442.55/0.00/491.66) lat (ms,95%): 47.47 err/s: 0.00 reconn/s: 0.00<br />[ 370s ] thds: 8 tps: 223.26 qps: 3570.11 (r/w/o: 3123.68/0.00/446.43) lat (ms,95%): 53.85 err/s: 0.00 reconn/s: 0.00<br />[ 380s ] thds: 8 tps: 220.22 qps: 3523.15 (r/w/o: 3082.62/0.00/440.53) lat (ms,95%): 54.83 err/s: 0.00 reconn/s: 0.00<br />[ 390s ] thds: 8 tps: 211.28 qps: 3381.89 (r/w/o: 2959.33/0.00/422.56) lat (ms,95%): 59.99 err/s: 0.00 reconn/s: 0.00<br />[ 400s ] thds: 8 tps: 203.18 qps: 3246.47 (r/w/o: 2840.21/0.00/406.26) lat (ms,95%): 62.19 err/s: 0.00 reconn/s: 0.00<br />[ 410s ] thds: 8 tps: 212.97 qps: 3413.10 (r/w/o: 2987.06/0.00/426.04) lat (ms,95%): 58.92 err/s: 0.00 reconn/s: 0.00<br />[ 420s ] thds: 8 tps: 200.17 qps: 3199.65 (r/w/o: 2799.41/0.00/400.24) lat (ms,95%): 61.08 err/s: 0.00 reconn/s: 0.00<br />[ 430s ] thds: 8 tps: 221.88 qps: 3550.15 (r/w/o: 3106.28/0.00/443.87) lat (ms,95%): 54.83 err/s: 0.00 reconn/s: 0.00<br />[ 440s ] thds: 8 tps: 237.57 qps: 3802.64 (r/w/o: 3327.50/0.00/475.14) lat (ms,95%): 49.21 err/s: 0.00 reconn/s: 0.00<br />[ 450s ] thds: 8 tps: 243.25 qps: 3891.42 (r/w/o: 3405.12/0.00/486.30) lat (ms,95%): 49.21 err/s: 0.00 reconn/s: 0.00<br />[ 460s ] thds: 8 tps: 242.73 qps: 3884.31 (r/w/o: 3398.66/0.00/485.65) lat (ms,95%): 48.34 err/s: 0.00 reconn/s: 0.00<br />[ 470s ] thds: 8 tps: 244.95 qps: 3917.28 (r/w/o: 3427.37/0.00/489.91) lat (ms,95%): 48.34 err/s: 0.00 reconn/s: 0.00<br />[ 480s ] thds: 8 tps: 239.13 qps: 3825.55 (r/w/o: 3347.40/0.00/478.16) lat (ms,95%): 50.11 err/s: 0.00 reconn/s: 0.00<br />[ 490s ] thds: 8 tps: 221.78 qps: 3547.29 (r/w/o: 3103.83/0.00/443.46) lat (ms,95%): 53.85 err/s: 0.00 reconn/s: 0.00<br />[ 500s ] thds: 8 tps: 220.60 qps: 3531.37 (r/w/o: 3090.08/0.00/441.30) lat (ms,95%): 54.83 err/s: 0.00 reconn/s: 0.00<br />[ 510s ] thds: 8 tps: 219.93 qps: 3519.55 (r/w/o: 3079.60/0.00/439.96) lat (ms,95%): 54.83 err/s: 0.00 reconn/s: 0.00<br />[ 520s ] thds: 8 tps: 214.06 qps: 3426.01 (r/w/o: 2997.90/0.00/428.11) lat (ms,95%): 56.84 err/s: 0.00 reconn/s: 0.00<br />[ 530s ] thds: 8 tps: 217.20 qps: 3476.19 (r/w/o: 3041.79/0.00/434.40) lat (ms,95%): 56.84 err/s: 0.00 reconn/s: 0.00<br />[ 540s ] thds: 8 tps: 218.60 qps: 3492.60 (r/w/o: 3055.40/0.00/437.20) lat (ms,95%): 56.84 err/s: 0.00 reconn/s: 0.00<br />[ 550s ] thds: 8 tps: 232.02 qps: 3716.01 (r/w/o: 3251.97/0.00/464.04) lat (ms,95%): 51.02 err/s: 0.00 reconn/s: 0.00<br />[ 560s ] thds: 8 tps: 246.32 qps: 3940.54 (r/w/o: 3447.90/0.00/492.64) lat (ms,95%): 48.34 err/s: 0.00 reconn/s: 0.00<br />[ 570s ] thds: 8 tps: 242.24 qps: 3877.49 (r/w/o: 3393.02/0.00/484.47) lat (ms,95%): 50.11 err/s: 0.00 reconn/s: 0.00<br />[ 580s ] thds: 8 tps: 242.36 qps: 3874.39 (r/w/o: 3389.68/0.00/484.71) lat (ms,95%): 49.21 err/s: 0.00 reconn/s: 0.00<br />[ 590s ] thds: 8 tps: 233.15 qps: 3731.94 (r/w/o: 3265.74/0.00/466.21) lat (ms,95%): 51.02 err/s: 0.00 reconn/s: 0.00<br />[ 600s ] thds: 8 tps: 226.11 qps: 3619.43 (r/w/o: 3167.11/0.00/452.33) lat (ms,95%): 53.85 err/s: 0.00 reconn/s: 0.00<br />SQL statistics:<br />    queries performed:<br />        read:                            1902544<br />        write:                           0<br />        other:                           271792<br />        total:                           2174336<br />    transactions:                        135896 (226.48 per sec.)<br />    queries:                             2174336 (3623.68 per sec.)<br />    ignored errors:                      0      (0.00 per sec.)<br />    reconnects:                          0      (0.00 per sec.)<br />General statistics:<br />    total time:                          600.0321s<br />    total number of events:              135896<br />Latency (ms):<br />         min:                                   15.44<br />         avg:                                   35.32<br />         max:                                  195.88<br />         95th percentile:                       53.85<br />         sum:                              4799248.18<br />Threads fairness:<br />    events (avg/stddev):           16987.0000/171.50<br />    execution time (avg/stddev):   599.9060/0.01<br />**TiDB Query Summary 中的 qps 与 duration截图**<br />![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598173203769-169ec0cd-fdc7-4ff6-9dd4-13431a0b249d.png#align=left&display=inline&height=519&margin=%5Bobject%20Object%5D&name=image.png&originHeight=519&originWidth=929&size=71775&status=done&style=none&width=929)<br />**TiKV Details 面板中 Cluster 中各 server 的 CPU 以及 QPS 指标截图**<br />**![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598173255565-dae0d0bb-0eb8-405b-baec-a23267acc9c1.png#align=left&display=inline&height=319&margin=%5Bobject%20Object%5D&name=image.png&originHeight=319&originWidth=930&size=49976&status=done&style=none&width=930)**<br />**![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598173272184-563cfde4-6655-4241-b136-0939222dfd17.png#align=left&display=inline&height=327&margin=%5Bobject%20Object%5D&name=image.png&originHeight=327&originWidth=929&size=82621&status=done&style=none&width=929)**<br />**<br />**TiKV Details 面板中 grpc 的 qps 以及 duration截图**<br />**![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598173322406-470c8e3a-4dfe-4f83-b5ce-1dbd73ec70da.png#align=left&display=inline&height=358&margin=%5Bobject%20Object%5D&name=image.png&originHeight=358&originWidth=927&size=48653&status=done&style=none&width=927)**<br />**![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598173353155-a3417eb2-8b42-4acf-8900-085ede2dd91d.png#align=left&display=inline&height=325&margin=%5Bobject%20Object%5D&name=image.png&originHeight=325&originWidth=926&size=63652&status=done&style=none&width=926)**<br />**![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598173364503-478eb2a9-cb7e-4b05-bfa1-dbe45be8ced9.png#align=left&display=inline&height=321&margin=%5Bobject%20Object%5D&name=image.png&originHeight=321&originWidth=924&size=66148&status=done&style=none&width=924)**
<a name="J5y0c"></a>
## 3.go-ycsb测试
[root@node2 go-ycsb]# ./bin/go-ycsb run mysql -P workloads/workloada -p operationcount=200000 -p mysql.host=10.30.23.62 -p mysql.port=4000 --threads 8<br />***************** properties *****************<br />"mysql.host"="10.30.23.62"<br />"readallfields"="true"<br />"updateproportion"="0.5"<br />"requestdistribution"="uniform"<br />"mysql.port"="4000"<br />"dotransactions"="true"<br />"threadcount"="8"<br />"operationcount"="200000"<br />"readproportion"="0.5"<br />"recordcount"="1000"<br />"workload"="core"<br />"scanproportion"="0"<br />"insertproportion"="0"<br />**********************************************<br />READ   - Takes(s): 10.0, Count: 6204, OPS: 621.0, Avg(us): 3360, Min(us): 849, Max(us): 29874, 99th(us): 10000, 99.9th(us): 18000, 99.99th(us): 30000<br />UPDATE - Takes(s): 10.0, Count: 6063, OPS: 607.5, Avg(us): 9720, Min(us): 4949, Max(us): 215941, 99th(us): 21000, 99.9th(us): 39000, 99.99th(us): 216000<br />READ   - Takes(s): 20.0, Count: 11943, OPS: 597.4, Avg(us): 3435, Min(us): 849, Max(us): 29874, 99th(us): 10000, 99.9th(us): 19000, 99.99th(us): 28000<br />UPDATE - Takes(s): 20.0, Count: 11928, OPS: 597.0, Avg(us): 9941, Min(us): 4685, Max(us): 215941, 99th(us): 22000, 99.9th(us): 134000, 99.99th(us): 213000<br />READ   - Takes(s): 30.0, Count: 17612, OPS: 587.2, Avg(us): 3477, Min(us): 849, Max(us): 29874, 99th(us): 10000, 99.9th(us): 18000, 99.99th(us): 28000<br />UPDATE - Takes(s): 30.0, Count: 17644, OPS: 588.5, Avg(us): 10096, Min(us): 4685, Max(us): 217853, 99th(us): 22000, 99.9th(us): 134000, 99.99th(us): 216000<br />READ   - Takes(s): 40.0, Count: 23150, OPS: 578.9, Avg(us): 3513, Min(us): 849, Max(us): 39733, 99th(us): 11000, 99.9th(us): 18000, 99.99th(us): 28000<br />UPDATE - Takes(s): 40.0, Count: 23243, OPS: 581.4, Avg(us): 10235, Min(us): 4685, Max(us): 224112, 99th(us): 23000, 99.9th(us): 143000, 99.99th(us): 216000<br />READ   - Takes(s): 50.0, Count: 28400, OPS: 568.1, Avg(us): 3538, Min(us): 849, Max(us): 39733, 99th(us): 11000, 99.9th(us): 18000, 99.99th(us): 28000<br />UPDATE - Takes(s): 50.0, Count: 28483, OPS: 569.9, Avg(us): 10483, Min(us): 4685, Max(us): 683133, 99th(us): 24000, 99.9th(us): 175000, 99.99th(us): 682000<br />READ   - Takes(s): 60.0, Count: 34261, OPS: 571.1, Avg(us): 3540, Min(us): 849, Max(us): 39733, 99th(us): 11000, 99.9th(us): 18000, 99.99th(us): 27000<br />UPDATE - Takes(s): 60.0, Count: 34108, OPS: 568.7, Avg(us): 10484, Min(us): 4685, Max(us): 683133, 99th(us): 24000, 99.9th(us): 173000, 99.99th(us): 678000<br />READ   - Takes(s): 70.0, Count: 39810, OPS: 568.8, Avg(us): 3556, Min(us): 849, Max(us): 39733, 99th(us): 11000, 99.9th(us): 19000, 99.99th(us): 27000<br />UPDATE - Takes(s): 70.0, Count: 39729, OPS: 567.7, Avg(us): 10500, Min(us): 4685, Max(us): 683133, 99th(us): 25000, 99.9th(us): 171000, 99.99th(us): 678000<br />READ   - Takes(s): 80.0, Count: 45592, OPS: 570.0, Avg(us): 3540, Min(us): 849, Max(us): 39733, 99th(us): 11000, 99.9th(us): 19000, 99.99th(us): 27000<br />UPDATE - Takes(s): 80.0, Count: 45463, OPS: 568.4, Avg(us): 10495, Min(us): 4685, Max(us): 683133, 99th(us): 25000, 99.9th(us): 159000, 99.99th(us): 678000<br />READ   - Takes(s): 90.0, Count: 51232, OPS: 569.3, Avg(us): 3549, Min(us): 849, Max(us): 39733, 99th(us): 11000, 99.9th(us): 19000, 99.99th(us): 27000<br />UPDATE - Takes(s): 90.0, Count: 51107, OPS: 568.0, Avg(us): 10496, Min(us): 4512, Max(us): 683133, 99th(us): 25000, 99.9th(us): 155000, 99.99th(us): 675000<br />READ   - Takes(s): 100.0, Count: 56917, OPS: 569.2, Avg(us): 3559, Min(us): 849, Max(us): 39733, 99th(us): 11000, 99.9th(us): 18000, 99.99th(us): 27000<br />UPDATE - Takes(s): 100.0, Count: 56612, OPS: 566.2, Avg(us): 10521, Min(us): 4512, Max(us): 683133, 99th(us): 25000, 99.9th(us): 171000, 99.99th(us): 675000<br />READ   - Takes(s): 110.0, Count: 62501, OPS: 568.2, Avg(us): 3573, Min(us): 849, Max(us): 39733, 99th(us): 11000, 99.9th(us): 18000, 99.99th(us): 27000<br />UPDATE - Takes(s): 110.0, Count: 62134, OPS: 565.0, Avg(us): 10537, Min(us): 4512, Max(us): 683133, 99th(us): 25000, 99.9th(us): 161000, 99.99th(us): 674000<br />READ   - Takes(s): 120.0, Count: 68232, OPS: 568.6, Avg(us): 3578, Min(us): 849, Max(us): 39733, 99th(us): 11000, 99.9th(us): 18000, 99.99th(us): 27000<br />UPDATE - Takes(s): 120.0, Count: 67690, OPS: 564.2, Avg(us): 10542, Min(us): 4512, Max(us): 683133, 99th(us): 25000, 99.9th(us): 159000, 99.99th(us): 674000<br />READ   - Takes(s): 130.0, Count: 73803, OPS: 567.8, Avg(us): 3588, Min(us): 849, Max(us): 43400, 99th(us): 11000, 99.9th(us): 19000, 99.99th(us): 31000<br />UPDATE - Takes(s): 130.0, Count: 73397, OPS: 564.7, Avg(us): 10530, Min(us): 4512, Max(us): 683133, 99th(us): 25000, 99.9th(us): 159000, 99.99th(us): 671000<br />READ   - Takes(s): 140.0, Count: 79393, OPS: 567.1, Avg(us): 3590, Min(us): 849, Max(us): 43400, 99th(us): 11000, 99.9th(us): 19000, 99.99th(us): 31000<br />UPDATE - Takes(s): 140.0, Count: 79018, OPS: 564.5, Avg(us): 10535, Min(us): 4512, Max(us): 683133, 99th(us): 25000, 99.9th(us): 155000, 99.99th(us): 671000<br />READ   - Takes(s): 150.0, Count: 85188, OPS: 568.0, Avg(us): 3586, Min(us): 849, Max(us): 43400, 99th(us): 11000, 99.9th(us): 19000, 99.99th(us): 31000<br />UPDATE - Takes(s): 150.0, Count: 84890, OPS: 566.0, Avg(us): 10506, Min(us): 4512, Max(us): 683133, 99th(us): 25000, 99.9th(us): 154000, 99.99th(us): 225000<br />READ   - Takes(s): 160.0, Count: 90762, OPS: 567.3, Avg(us): 3591, Min(us): 849, Max(us): 43400, 99th(us): 11000, 99.9th(us): 18000, 99.99th(us): 30000<br />UPDATE - Takes(s): 160.0, Count: 90601, OPS: 566.3, Avg(us): 10499, Min(us): 4512, Max(us): 683133, 99th(us): 24000, 99.9th(us): 149000, 99.99th(us): 225000<br />READ   - Takes(s): 170.0, Count: 96286, OPS: 566.4, Avg(us): 3594, Min(us): 849, Max(us): 43400, 99th(us): 11000, 99.9th(us): 18000, 99.99th(us): 30000<br />UPDATE - Takes(s): 170.0, Count: 96156, OPS: 565.7, Avg(us): 10513, Min(us): 4512, Max(us): 683133, 99th(us): 24000, 99.9th(us): 149000, 99.99th(us): 225000<br />Run finished, takes 2m57.791011628s<br />READ   - Takes(s): 177.8, Count: 100119, OPS: 563.2, Avg(us): 3593, Min(us): 849, Max(us): 43400, 99th(us): 11000, 99.9th(us): 18000, 99.99th(us): 30000<br />UPDATE - Takes(s): 177.8, Count: 99881, OPS: 561.9, Avg(us): 10500, Min(us): 4512, Max(us): 683133, 99th(us): 24000, 99.9th(us): 149000, 99.99th(us): 225000<br />
<br />**TiDB Query Summary 中的 qps 与 duration截图**<br />![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598174450496-2a16cf0d-db79-47d2-ab89-e6aa670d5060.png#align=left&display=inline&height=516&margin=%5Bobject%20Object%5D&name=image.png&originHeight=516&originWidth=927&size=65448&status=done&style=none&width=927)<br />**TiKV Details 面板中 Cluster 中各 server 的 CPU 以及 QPS 指标截图**<br />**![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598174550295-ca9ed79c-4073-4762-96ca-ca129875a2c4.png#align=left&display=inline&height=326&margin=%5Bobject%20Object%5D&name=image.png&originHeight=326&originWidth=938&size=50187&status=done&style=none&width=938)**<br />**![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598174562412-1358b4c1-10f9-4bba-b75d-494ab54847d0.png#align=left&display=inline&height=327&margin=%5Bobject%20Object%5D&name=image.png&originHeight=327&originWidth=923&size=64230&status=done&style=none&width=923)**<br />**TiKV Details 面板中 grpc 的 qps 以及 duration截图**<br />![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598174593057-93c9e386-e8c2-491e-bf75-3e1702e7db62.png#align=left&display=inline&height=328&margin=%5Bobject%20Object%5D&name=image.png&originHeight=328&originWidth=924&size=59530&status=done&style=none&width=924)<br />![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598174620426-be4beb0d-49b3-4a34-8fb2-08728a78cddd.png#align=left&display=inline&height=330&margin=%5Bobject%20Object%5D&name=image.png&originHeight=330&originWidth=918&size=67031&status=done&style=none&width=918)<br />![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598174634725-849ac1d0-6001-469a-ad8b-f149e62f6d8a.png#align=left&display=inline&height=355&margin=%5Bobject%20Object%5D&name=image.png&originHeight=355&originWidth=931&size=47513&status=done&style=none&width=931)
<a name="jUwbM"></a>
## 4.go-tpc测试
**tpc-c **<br />**load 8 warehouse (开始测100 但是跑不完了)**<br />[root@node2 go-tpc]# ./bin/go-tpc tpcc -H 10.30.23.62  -P 4000 -D tpcc --warehouses 8 run --time 1m --threads 4<br />[Current] DELIVERY - Takes(s): 9.8, Count: 50, TPM: 306.4, Sum(ms): 5274, Avg(ms): 105, 90th(ms): 128, 99th(ms): 160, 99.9th(ms): 160<br />[Current] NEW_ORDER - Takes(s): 9.9, Count: 583, TPM: 3527.4, Sum(ms): 19386, Avg(ms): 33, 90th(ms): 48, 99th(ms): 80, 99.9th(ms): 80<br />[Current] ORDER_STATUS - Takes(s): 9.9, Count: 43, TPM: 260.2, Sum(ms): 428, Avg(ms): 9, 90th(ms): 16, 99th(ms): 24, 99.9th(ms): 24<br />[Current] PAYMENT - Takes(s): 9.9, Count: 579, TPM: 3498.3, Sum(ms): 13366, Avg(ms): 23, 90th(ms): 32, 99th(ms): 64, 99.9th(ms): 64<br />[Current] STOCK_LEVEL - Takes(s): 9.7, Count: 44, TPM: 270.9, Sum(ms): 583, Avg(ms): 13, 90th(ms): 16, 99th(ms): 20, 99.9th(ms): 20<br />[Current] DELIVERY - Takes(s): 10.0, Count: 55, TPM: 331.0, Sum(ms): 6380, Avg(ms): 116, 90th(ms): 192, 99th(ms): 256, 99.9th(ms): 256<br />[Current] NEW_ORDER - Takes(s): 10.0, Count: 585, TPM: 3515.0, Sum(ms): 19016, Avg(ms): 32, 90th(ms): 48, 99th(ms): 64, 99.9th(ms): 96<br />[Current] ORDER_STATUS - Takes(s): 9.7, Count: 52, TPM: 323.1, Sum(ms): 564, Avg(ms): 10, 90th(ms): 16, 99th(ms): 48, 99.9th(ms): 48<br />[Current] PAYMENT - Takes(s): 10.0, Count: 545, TPM: 3271.7, Sum(ms): 12902, Avg(ms): 23, 90th(ms): 32, 99th(ms): 64, 99.9th(ms): 96<br />[Current] STOCK_LEVEL - Takes(s): 10.0, Count: 42, TPM: 252.9, Sum(ms): 571, Avg(ms): 13, 90th(ms): 16, 99th(ms): 32, 99.9th(ms): 32<br />[Current] DELIVERY - Takes(s): 9.9, Count: 48, TPM: 292.3, Sum(ms): 5287, Avg(ms): 110, 90th(ms): 160, 99th(ms): 192, 99.9th(ms): 192<br />[Current] NEW_ORDER - Takes(s): 10.0, Count: 578, TPM: 3469.5, Sum(ms): 18468, Avg(ms): 31, 90th(ms): 40, 99th(ms): 80, 99.9th(ms): 96<br />[Current] ORDER_STATUS - Takes(s): 9.3, Count: 53, TPM: 341.5, Sum(ms): 519, Avg(ms): 9, 90th(ms): 16, 99th(ms): 32, 99.9th(ms): 32<br />[Current] PAYMENT - Takes(s): 10.0, Count: 607, TPM: 3651.6, Sum(ms): 14177, Avg(ms): 23, 90th(ms): 40, 99th(ms): 64, 99.9th(ms): 80<br />[Current] STOCK_LEVEL - Takes(s): 9.8, Count: 64, TPM: 393.4, Sum(ms): 834, Avg(ms): 13, 90th(ms): 16, 99th(ms): 20, 99.9th(ms): 20<br />[Current] DELIVERY - Takes(s): 9.8, Count: 51, TPM: 311.6, Sum(ms): 5824, Avg(ms): 114, 90th(ms): 160, 99th(ms): 512, 99.9th(ms): 512<br />[Current] NEW_ORDER - Takes(s): 10.0, Count: 583, TPM: 3498.6, Sum(ms): 19036, Avg(ms): 32, 90th(ms): 48, 99th(ms): 96, 99.9th(ms): 112<br />[Current] ORDER_STATUS - Takes(s): 9.8, Count: 53, TPM: 326.0, Sum(ms): 515, Avg(ms): 9, 90th(ms): 12, 99th(ms): 24, 99.9th(ms): 24<br />[Current] PAYMENT - Takes(s): 10.0, Count: 544, TPM: 3265.1, Sum(ms): 13152, Avg(ms): 24, 90th(ms): 40, 99th(ms): 96, 99.9th(ms): 160<br />[Current] STOCK_LEVEL - Takes(s): 9.9, Count: 61, TPM: 368.5, Sum(ms): 847, Avg(ms): 13, 90th(ms): 16, 99th(ms): 32, 99.9th(ms): 32<br />[Current] DELIVERY - Takes(s): 9.7, Count: 45, TPM: 278.6, Sum(ms): 5285, Avg(ms): 117, 90th(ms): 160, 99th(ms): 512, 99.9th(ms): 512<br />[Current] NEW_ORDER - Takes(s): 10.0, Count: 596, TPM: 3579.4, Sum(ms): 19301, Avg(ms): 32, 90th(ms): 48, 99th(ms): 80, 99.9th(ms): 128<br />[Current] ORDER_STATUS - Takes(s): 10.0, Count: 61, TPM: 366.2, Sum(ms): 763, Avg(ms): 12, 90th(ms): 20, 99th(ms): 80, 99.9th(ms): 80<br />[Current] PAYMENT - Takes(s): 10.0, Count: 559, TPM: 3370.1, Sum(ms): 13197, Avg(ms): 23, 90th(ms): 40, 99th(ms): 64, 99.9th(ms): 80<br />[Current] STOCK_LEVEL - Takes(s): 9.8, Count: 56, TPM: 343.1, Sum(ms): 774, Avg(ms): 13, 90th(ms): 16, 99th(ms): 24, 99.9th(ms): 24<br />Finished<br />[Summary] DELIVERY - Takes(s): 59.8, Count: 300, TPM: 301.0, Sum(ms): 33934, Avg(ms): 113, 90th(ms): 160, 99th(ms): 256, 99.9th(ms): 512<br />[Summary] NEW_ORDER - Takes(s): 59.9, Count: 3516, TPM: 3520.8, Sum(ms): 114136, Avg(ms): 32, 90th(ms): 48, 99th(ms): 80, 99.9th(ms): 112<br />[Summary] NEW_ORDER_ERR - Takes(s): 59.9, Count: 1, TPM: 1.0, Sum(ms): 8, Avg(ms): 8, 90th(ms): 8, 99th(ms): 8, 99.9th(ms): 8<br />[Summary] ORDER_STATUS - Takes(s): 59.9, Count: 316, TPM: 316.4, Sum(ms): 3380, Avg(ms): 10, 90th(ms): 16, 99th(ms): 32, 99.9th(ms): 80<br />[Summary] PAYMENT - Takes(s): 59.9, Count: 3416, TPM: 3419.9, Sum(ms): 79961, Avg(ms): 23, 90th(ms): 40, 99th(ms): 64, 99.9th(ms): 112<br />[Summary] STOCK_LEVEL - Takes(s): 59.7, Count: 321, TPM: 322.4, Sum(ms): 4397, Avg(ms): 13, 90th(ms): 16, 99th(ms): 32, 99.9th(ms): 32<br />tpmC: 3520.8<br />**TiDB Query Summary 中的 qps 与 duration截图**<br />** ![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598345205157-3065538b-20a5-4e7a-a87d-641796f31683.png#align=left&display=inline&height=519&margin=%5Bobject%20Object%5D&name=image.png&originHeight=519&originWidth=922&size=74252&status=done&style=none&width=922)**<br />**TiKV Details 面板中 Cluster 中各 server 的 CPU 以及 QPS 指标截图**<br />**![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598345273506-0d4bfd47-77ca-457d-872b-250088977a61.png#align=left&display=inline&height=323&margin=%5Bobject%20Object%5D&name=image.png&originHeight=323&originWidth=931&size=40840&status=done&style=none&width=931)**<br />**![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598345305565-31d03548-140f-4599-acc4-13d04663403e.png#align=left&display=inline&height=323&margin=%5Bobject%20Object%5D&name=image.png&originHeight=323&originWidth=932&size=81312&status=done&style=none&width=932)**<br />**TiKV Details 面板中 grpc 的 qps 以及 duration截图**<br />**![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598345349854-d3a76da7-57f5-4eaf-b567-517bd58fabe6.png#align=left&display=inline&height=318&margin=%5Bobject%20Object%5D&name=image.png&originHeight=318&originWidth=916&size=55077&status=done&style=none&width=916)**<br />**![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598345363728-6d0784ca-d858-4360-8612-f597025b20e7.png#align=left&display=inline&height=318&margin=%5Bobject%20Object%5D&name=image.png&originHeight=318&originWidth=926&size=58952&status=done&style=none&width=926)**<br />**![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598345391691-86765e9d-7f39-4c8d-88ed-9951e962b979.png#align=left&display=inline&height=354&margin=%5Bobject%20Object%5D&name=image.png&originHeight=354&originWidth=914&size=59631&status=done&style=none&width=914)**<br />**tpc-h **<br />**load sf 4**<br />**<br />[root@node2 go-tpc]# ./bin/go-tpc tpch run -H 10.30.23.62 -P 4000 -D tpch --sf 4<br />[Current] Q1: 0.01s<br />[Current] Q2: 1.97s<br />[Current] Q3: 4.36s<br />[Current] Q4: 1.60s<br />[Current] Q5: 5.83s<br />[Current] Q6: 0.03s<br />[Current] Q7: 4.21s<br />[2020-08-25 17:14:06] execute run failed, err execute query  <br />select<br />	nation,<br />	o_year,<br />	sum(amount) as sum_profit<br />from<br />	(<br />  select<br />  	n_name as nation,<br />  	extract(year from o_orderdate) as o_year,<br />  	l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount<br />  from<br />  	part,<br />  	supplier,<br />  	lineitem,<br />  	partsupp,<br />  	orders,<br />  	nation<br />  where<br />  	s_suppkey = l_suppkey<br />  	and ps_suppkey = l_suppkey<br />  	and ps_partkey = l_partkey<br />  	and p_partkey = l_partkey<br />  	and o_orderkey = l_orderkey<br />  	and s_nationkey = n_nationkey<br />  	and p_name like '%dim%'<br />	) as profit<br />group by<br />	nation,<br />	o_year<br />order by<br />	nation,<br />	o_year desc;<br /> failed Error 1105: Out Of Memory Quota![conn_id=48]<br />execute run failed, err execute query  <br />select<br />	nation,<br />	o_year,<br />	sum(amount) as sum_profit<br />from<br />	(<br />  select<br />  	n_name as nation,<br />  	extract(year from o_orderdate) as o_year,<br />  	l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount<br />  from<br />  	part,<br />  	supplier,<br />  	lineitem,<br />  	partsupp,<br />  	orders,<br />  	nation<br />  where<br />  	s_suppkey = l_suppkey<br />  	and ps_suppkey = l_suppkey<br />  	and ps_partkey = l_partkey<br />  	and p_partkey = l_partkey<br />  	and o_orderkey = l_orderkey<br />  	and s_nationkey = n_nationkey<br />  	and p_name like '%dim%'<br />	) as profit<br />group by<br />	nation,<br />	o_year<br />order by<br />	nation,<br />	o_year desc;<br /> failed Error 1105: Out Of Memory Quota![conn_id=48]<br />Finished<br />
<br />tidb配置调整<br />内存溢出报错，应该调整一下tidb的默认参数了<br />主要增加mem-quota-query 调整到2g <br />tikv grpc压缩开启 <br />grpc-compression-type: gzip<br />其他暂时不动 <br />如下:<br />![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598351720289-a3ed2571-1d52-44dd-a418-be5a28d73120.png#align=left&display=inline&height=853&margin=%5Bobject%20Object%5D&name=image.png&originHeight=853&originWidth=827&size=65310&status=done&style=none&width=827)<br />
<br />
<br />
<br />测试结果<br />[root@node2 go-tpc]# ./bin/go-tpc tpch run -H 10.30.23.62 -P 4000 -D tpch --sf 4<br />[Current] Q1: 8.52s<br />[Current] Q2: 3.02s<br />[Current] Q3: 7.05s<br />[Current] Q4: 2.16s<br />[Current] Q5: 6.94s<br />[Current] Q6: 2.57s<br />[Current] Q7: 4.63s<br />[Current] Q8: 4.18s<br />[Current] Q9: 56.21s<br />[Current] Q10: 5.08s<br />[Current] Q11: 1.67s<br />[Current] Q12: 3.76s<br />[Current] Q13: 4.56s<br />[Current] Q14: 2.96s<br />[Current] Q15: 3.29s<br />[Current] Q16: 2.83s<br />[Current] Q17: 13.34s<br />[Current] Q18: 18.54s<br />[Current] Q19: 4.90s<br />[Current] Q20: 3.21s<br />[Current] Q21: 7.76s<br />[Current] Q1: 3.78s<br />[Current] Q2: 1.92s<br />[Current] Q22: 2.83s<br />[Current] Q3: 5.20s<br />[Current] Q4: 2.06s<br />[Current] Q5: 7.40s<br />[Current] Q6: 1.43s<br />[Current] Q7: 5.31s<br />[Current] Q8: 3.72s<br />[Current] Q10: 5.59s<br />[Current] Q11: 1.73s<br />[Current] Q9: 59.19s<br />[Current] Q12: 3.26s<br />[Current] Q13: 4.34s<br />[Current] Q14: 2.06s<br />[Current] Q15: 1.00s<br />[Current] Q16: 1.40s<br />[Current] Q17: 12.75s<br />[Current] Q18: 17.34s<br />[Current] Q19: 4.74s<br />[Current] Q20: 2.26s<br />[Current] Q21: 6.44s<br />[Current] Q22: 2.46s<br />[Current] Q1: 4.45s<br />[Current] Q2: 1.95s<br />[Current] Q3: 5.03s<br />[Current] Q4: 1.74s<br />^C<br />Got signal [interrupt] to exit.<br />Finished<br />[Summary] Q1: 5.58s<br />[Summary] Q10: 5.34s<br />[Summary] Q11: 1.70s<br />[Summary] Q12: 3.51s<br />[Summary] Q13: 4.45s<br />[Summary] Q14: 2.51s<br />[Summary] Q15: 2.14s<br />[Summary] Q16: 2.11s<br />[Summary] Q17: 13.04s<br />[Summary] Q18: 17.94s<br />[Summary] Q19: 4.82s<br />[Summary] Q2: 2.29s<br />[Summary] Q20: 2.74s<br />[Summary] Q21: 7.10s<br />[Summary] Q22: 2.64s<br />[Summary] Q3: 5.76s<br />[Summary] Q4: 1.98s<br />[Summary] Q5: 7.17s<br />[Summary] Q6: 2.00s<br />[Summary] Q7: 4.97s<br />[Summary] Q8: 3.95s<br />[Summary] Q9: 57.70s<br />**TiDB Query Summary 中的 qps 与 duration截图**<br />![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598349031394-cf328e62-435f-45c0-9fd2-7f41955074a5.png#align=left&display=inline&height=526&margin=%5Bobject%20Object%5D&name=image.png&originHeight=526&originWidth=915&size=71010&status=done&style=none&width=915)<br />**TiKV Details 面板中 Cluster 中各 server 的 CPU 以及 QPS 指标截图**<br />![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598349078622-2ed487cd-64a9-4b5e-8f0f-119de716e836.png#align=left&display=inline&height=337&margin=%5Bobject%20Object%5D&name=image.png&originHeight=337&originWidth=928&size=47295&status=done&style=none&width=928)<br />![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598349112235-a5ce7983-6a0f-4160-8f5c-f8aef988ed7a.png#align=left&display=inline&height=325&margin=%5Bobject%20Object%5D&name=image.png&originHeight=325&originWidth=923&size=57082&status=done&style=none&width=923)<br />
<br />**TiKV Details 面板中 grpc 的 qps 以及 duration截图**<br />**![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598349147942-42733dd2-ff7e-40c6-b99c-ea147f8d8c9c.png#align=left&display=inline&height=318&margin=%5Bobject%20Object%5D&name=image.png&originHeight=318&originWidth=923&size=42393&status=done&style=none&width=923)**<br />**<br />![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598349160948-d7bdae94-4472-4b8c-8ea2-2f71f93ced5e.png#align=left&display=inline&height=324&margin=%5Bobject%20Object%5D&name=image.png&originHeight=324&originWidth=920&size=46951&status=done&style=none&width=920)<br />![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598349182975-3bae12f4-dd22-4dd3-8298-057f165cb8dc.png#align=left&display=inline&height=325&margin=%5Bobject%20Object%5D&name=image.png&originHeight=325&originWidth=929&size=38886&status=done&style=none&width=929)<br />
<br />同时查看promethus 监控，dashboard 性能分析<br />可能主要还是读取数据性能损耗多，读取数据格式化成row行数据开辟内存损耗，应该还是和sql和表结构有关系<br />![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598351945061-b2a50382-02de-4cba-8128-42aabbdbb1cb.png#align=left&display=inline&height=957&margin=%5Bobject%20Object%5D&name=image.png&originHeight=957&originWidth=1452&size=181692&status=done&style=none&width=1452)<br />tikv是火焰图<br />![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598352254173-6e0878b5-3708-4109-971f-8bb0a4d2d940.png#align=left&display=inline&height=380&margin=%5Bobject%20Object%5D&name=image.png&originHeight=380&originWidth=1298&size=165139&status=done&style=none&width=1298)<br />rocksdb lz4压缩 损耗性能较多，可能可以调整一下压缩算法，这块待研究和测试<br />pd没看出明显瓶颈，单个模块最多消耗10ms<br />![image.png](https://cdn.nlark.com/yuque/0/2020/png/1389378/1598352492042-18e8d3cf-30b7-433e-8d44-4b87ca7a4089.png#align=left&display=inline&height=936&margin=%5Bobject%20Object%5D&name=image.png&originHeight=936&originWidth=1920&size=202144&status=done&style=none&width=1920)<br />

